/*!CK:3722866482!*//*1418625114,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["DFcFC"]); }

__d("InteractionLogger",["Arbiter","Banzai","Event","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){function k(l,m){m=m||{};this.profiler={};this.log={};this.lastInteraction=Date.now();this.interactionTime=0;this.eventSequence=[];this.projectName=l;if(m.trackInteractionTime)i.listen(document.body,'mousemove',this._pingActive.bind(this));if(m.submitOnLeave||m.submitOnLeave===(void 0))this.arbiterToken=g.subscribe('onload/exit',function(){this.submit();this.arbiterToken.unsubscribe();}.bind(this));}j(k,{IDLE_LIMIT:20000});j(k.prototype,{set:function(l,m){this.log[l]=m;},tap:function(l){this.eventSequence.push(l);},bump:function(l,m){if(m===(void 0))m=1;this.log[l]=(this.log[l]||0)+m;},bumpTap:function(l,m){this.tap(l);this.bump(l,m);},startRun:function(l){if(!this.profiler[l])this.profiler[l]={average:0,count:0};this.profiler[l].start=+new Date();},endRun:function(l){if(!this.profiler[l]||!this.profiler[l].start)return;this._recordRun(l,new Date()-this.profiler[l].start);this.profiler[l].start=null;},getLog:function(){this._updateLog();return this.log;},submit:function(){this._updateLog();h.post(this.projectName,this.log);},_pingActive:function(){var l=Date.now(),m=l-this.lastInteraction;if(m<(k.IDLE_LIMIT))this.interactionTime+=m;this.lastInteraction=l;},_updateLog:function(){for(var l in this.profiler){this.log[l+'-count']=this.profiler[l].count;this.log[l+'-average']=this.profiler[l].average;}if(this.interactionTime)this.log['interaction-time']=this.interactionTime;if(this.eventSequence.length)this.log['event-sequence']=this.eventSequence;},_recordRun:function(l,m){var n=this.profiler[l];n.average=(n.average*n.count+m)/(n.count+1);n.count++;}});e.exports=k;},null);
__d("MapPager",["ArbiterMixin","Event","mixin"],function(a,b,c,d,e,f,g,h,i){var j=i(g);for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(n,o){"use strict";h.listen(n,'click',this.inform.bind(this,'previous'));h.listen(o,'click',this.inform.bind(this,'next'));}e.exports=m;},null);
__d("TimelineMapFilter",["Arbiter","CSS","DOM","Event","NumberFormatConfig","PageTransitions","ProfileTabConst","StickyPlaceholderInput","TimelineURI","$","copyProperties","cx","ads-lib-formatters","ge","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v='pagelet_timeline_medley_map';function w(y){return o.getSKFromURI(y)===m.MAP;}function x(){}q(x.prototype,{init:function(y,z,aa,ba,ca){this._classes={count:"_3d0",filter:"_3c_",selected:"_3s-",text:"_3sz"};this.catNames=[];this.catIndex=0;this.categoryButtons=[];this.mapController=y;this.stickies=z||[];this.tagUnit=t('fbTimelineMapTagUnit');this.tagUnitInited=false;this.mapID=aa;this.pluralMap=ba;this.initialCatName=ca;var da={},ea,fa;for(ea=0;ea<this.stickies.length;ea++){fa=this.stickies[ea].name[2];da[fa]=this.stickies[ea].countOnlyUnique;this.categoryButtons[ea]=this.stickies[ea].buttonID&&t(this.stickies[ea].buttonID);if(this.categoryButtons[ea])j.listen(this.categoryButtons[ea],'click',this.handleTabClick.bind(this,ea));}this.mapController.setCategoryCountUnique(da);u([g.subscribe('TimelineMap/updateCategories',this.updateCategories.bind(this))]);},setCategory:function(y){this.mapController.setCategory(this.catNames[y]);var z=p(v),aa=i.scry(z,'.fbTimelineStickyHeaderPlaceComposer input.skiptowant')[0];if(aa)aa.setAttribute('value',this.stickies[y].name.skip_to_want);var ba=i.scry(z,'.fbTimelineStickyHeaderPlaceComposer div.uiStickyPlaceholderInput')[0];if(ba)n.setPlaceholderText(ba,this.stickies[y].name.placeholder);var ca=i.scry(z,'div.'+"_4_zv")[0];if(ca)i.setContent(ca,this.stickies[y].name.section_title);},handleTabClick:function(y,z){var aa=l.getCurrentURI().getUnqualifiedURI();z&&!z.isDefaultRequested()&&z.prevent();if(w(aa)&&this.stickies[y].uri)l.rewriteCurrentURI(aa,this.stickies[y].uri);this.setCategory(y);this.mapController.zoomToVisible();},setFilter:function(y,z,aa,ba,ca){var da=this.categoryButtons[y];if(!da)return;var ea=aa||0;if(ea>=200)ea=(ea%100)+100;ea=z[this.pluralMap[ea]];this.catNames[y]=z[2];i.setContent(i.find(da,'.'+this._classes.text),ea);if(aa){i.setContent(i.find(da,'.'+this._classes.count),s.formatNumber(aa,0,k.numberDelimiter,''));}else i.empty(i.find(da,'.'+this._classes.count));h.conditionClass(da.firstChild,ba,!!ba);if(ca)da.setAttribute('href',ca);h.show(da);},updateCategories:function(y,z){if(z._instanceid!==this.mapID)return;var aa=this.mapController.getCategories(),ba=this.catNames[this.catIndex]||this.initialCatName;this.catNames=[];var ca=0;for(var da=0;da<this.stickies.length;da++){var ea=this.stickies[da],fa=ea.name,ga=0,ha=ea.domClass,ia=fa[2];if(aa[ia]){ga=aa[ia].count;delete aa[ia];}if(ea.showWhenZero||ga!==0){this.setFilter(ca,fa,ga,ha,ea.uri);ca++;}}var ja=[];for(var ka in aa)ja.push(aa[ka]);ja=ja.sort(function(oa,pa){return pa.count-oa.count;});for(var la=0;la<this.categoryButtons.length-ca;la++){var ma=ja[la];if(ma){this.setFilter(la+ca,ma.name,ma.count);}else h.hide(this.filters[la+ca]);}if(ba){this.initialCatName=null;var na=this.catNames.indexOf(ba);if(na!=-1){this.setCategory(na);}else this.setCategory(0);}}});q(x,{init:function(){var y=new x();y.init.apply(y,arguments);}});e.exports=x;},null);
__d("TimelineMapStickyHeaderComposer",["Arbiter","AsyncRequest","Bootloader","CSS","$","bind","copyProperties","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){g.subscribe('TimelineMapStickyHeaderComposer/showPhotoTagUnit',this.showPhotoTagUnit.bind(this));g.subscribe('TimelineMapStickyHeaderComposer/hidePhotoTagUnit',this.hidePhotoTagUnit.bind(this));}m(o.prototype,{initPlaceTypeahead:function(p){p.subscribe('focus',function(){i.loadModules(["TimelineMLE"],function(q){q.hideFlyout();});g.inform('TimelineMapStickyHeaderComposer/typeaheadFocus');}.bind(this));p.subscribe('blur',function(){g.inform('TimelineMapStickyHeaderComposer/typeaheadBlur');}.bind(this));p.subscribe('select',function(){g.inform('TimelineMapStickyHeaderComposer/typeaheadSelect');}.bind(this));},showPhotoTagUnit:function(p,q){this.tagUnit=k('fbTimelineMapTagUnit');j.show(this.tagUnit);var r=n('mainContainer');r&&j.addClass(r,'photoTaggingMode');if(!this.tagUnitInited){this.tagUnitInited=true;this.indicator=k('fbTimelineMapAddPhotoLoading');j.show(this.indicator);var s=q?q.sid:null;new h().setURI('/ajax/timeline/map/photo_strip.php').setData({div_id:'fbTimelineMapTagUnit',sid:s}).setReadOnly(true).setHandler(l(this,'_onLoadPhotoStrip')).send();}else this._onLoadPhotoStrip();},hidePhotoTagUnit:function(){this.tagUnit=k('fbTimelineMapTagUnit');j.hide(this.tagUnit);var p=n('mainContainer');p&&j.removeClass(p,'photoTaggingMode');},_onLoadPhotoStrip:function(){j.hide(this.indicator);}});e.exports=o;},null);
__d("legacy:TimelineMapStickyHeaderComposer",["TimelineMapStickyHeaderComposer"],function(a,b,c,d){a.TimelineMapStickyHeaderComposer=b('TimelineMapStickyHeaderComposer');},3);
__d("TypeaheadTimelineHighlightMapPlace",["Arbiter","copyProperties"],function(a,b,c,d,e,f,g,h){function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe(['reset','select','highlight'],function(j,k){if(j==='highlight'&&k.index!==-1&&k.selected.type!='freeform'&&k.selected.latitude&&k.selected.longitude&&!k.selected.changeCity&&k.index!=this.lastDataIdx){var l=k.selected.place_type=='city'?10:15;g.inform('TimelineMap/highlightMapPlace',{placeID:k.selected.uid,center:{latitude:k.selected.latitude,longitude:k.selected.longitude},zoom:l});}else if(j==='highlight'&&k.index==-1){g.inform('TimelineMap/highlightMapPlace',{dismiss:true});}else if(j==='select'){g.inform('TimelineMap/highlightMapPlace',{selected:true});}else if(j==='reset')g.inform('TimelineMap/highlightMapPlace',{dismiss:true});this.lastDataIdx=k&&k.index;});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;},null);
__d("TypeaheadTimelineShowThrobberOnSelect",["Arbiter","copyProperties"],function(a,b,c,d,e,f,g,h){function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe(['select'],function(j,k){g.inform('TimelineMap/highlightMapPlace',{showThrobber:true});});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;},null);
__d("legacy:TimelineMapPlaceTypeaheadBehaviors",["TypeaheadTimelineHighlightMapPlace","TypeaheadTimelineShowThrobberOnSelect"],function(a,b,c,d,e,f,g,h){if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.highlightMapPlace=function(i){i.enableBehavior(g);};a.TypeaheadBehaviors.showThrobberOnSelect=function(i){i.enableBehavior(h);};},3);
__d("RelationshipStatusConst",["fbt"],function(a,b,c,d,e,f,g){e.exports={UNDEFINED:0,SINGLE:1,IN_A_RELATIONSHIP:2,OPEN_RELATIONSHIP:3,MARRIED:4,ENGAGED:5,COMPLICATED:6,WIDOWED:7,SEPARATED:8,DIVORCED:9,CIVIL_UNION:10,DOMESTIC_PATNERSHIP:11,isUnilateralStatus:function(h){return (h==this.UNDEFINED||h==this.SINGLE||h==this.WIDOWED||h==this.SEPARATED||h==this.DIVORCED);},getAnniversaryText:function(h){switch(h){case this.IN_A_RELATIONSHIP:case this.OPEN_RELATIONSHIP:case this.MARRIED:case this.CIVIL_UNION:case this.DOMESTIC_PARTNERSHIP:return ("Anniversary");case this.ENGAGED:case this.COMPLICATED:return ("Since");default:throw new Error('Relationship status doesn\'t support anniversaries');}},willCreateLifeEvent:function(h,i,j,k){if(this.isUnilateralStatus(i))return false;if(i==this.COMPLICATED&&!this.isUnilateralStatus(h))return false;if(i!=h)return true;if(j>0&&k>0&&j!=k)return true;return false;}};},null);
__d("TimelineInfoReviewRelationshipForm.react",["ReactPropTypes","React","RelationshipStatusConst","ProfileChecklist.react","ProfileMaskedTypeahead.react","ProfileTypeaheadContainer.react","createObjectFrom","cx","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=h.createClass({displayName:"TimelineInfoReviewRelationshipForm",propTypes:{excludedEntries:g.array.isRequired,options:g.array.isRequired,placeholder:g.string.isRequired,relationName:g.string.isRequired,relationshipName:g.string.isRequired,searchSource:g.object.isRequired,selectedRelationship:g.number},getDefaultProps:function(){return {selectedRelationship:null};},getInitialState:function(){return {selectedRelationship:this.props.selectedRelationship};},render:function(){var q=this.state.selectedRelationship,r=null;if(q&&!i.isUnilateralStatus(q))r=h.createElement(l,null,h.createElement(k,{excludedEntries:m(this.props.excludedEntries,true),placeholder:this.props.placeholder,requireSelection:true,searchSource:this.props.searchSource,initialEntry:this.props.selectedEntry,selectionName:this.props.relationName}));return (h.createElement("div",null,h.createElement(j,{baseName:this.props.relationshipName,className:"_5us2",onChange:this._checklistChangeHandler,options:this.props.options,overflow:"scroll",ref:"checklist"}),r));},_checklistChangeHandler:function(){var q=Object.keys(this.refs.checklist.getSelection());o(q.length<=1);this.state.selectedRelationship=q.length===1?parseInt(q[0],10):null;this.forceUpdate();}});e.exports=p;},null);
__d("PlacesAppAddPlacesCuration",["Arbiter","TimelineAppSectionCuration"],function(a,b,c,d,e,f,g,h){var i={registerContent:function(j){h.register(j,function(k,l,m){g.inform('TimelineMapStickyHeaderComposer/showPhotoTagUnit');m.unsubscribe();});}};e.exports=i;},null);
__d("TimelineLifeEventPhotoPreviewGrid",["ActorURI","AsyncUploadRequest","AsyncRequest","Bootloader","CSS","DOM","FileInputUploader","Parent","ProgressBar","SortableGroup","TimelineLifeEventPhotoConfig","fbt","Button","csx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=1,v=2,w=3,x=[null,'mleOnePhoto','mleTwoPhotos','mleManyPhotos'];function y(ca,da,ea,fa){"use strict";this._container=ca;this._containerID=ca.id;this._grid=da;this._photoLimit=ea;this._profileID=fa;this._progressBarMarkup=q.progressBarMarkup;this._loadingIndicators=[];this._pendingPhotoRequests=0;this._photoDisplayType=0;this._tempPhotoRef=[];this._saveButton=l.find(this._container,"._5mlk");if(!q.enableDrag)return;this._sortableGroup=new p().setGrabCallback(aa).setDropCallback(ba);var ga=l.scry(da,'.mlePhotoPreviewThumb');for(var ha=0;ha<ga.length;ha++)this._bindPhoto(ga[ha]);this._updatePhotoDisplayType(ga.length);}y.prototype.destroy=function(){"use strict";this._sortableGroup&&this._sortableGroup.destroy();};y.prototype._getNumPhotos=function(){"use strict";return l.scry(this._grid,'.mlePhotoPreviewThumb').length+l.scry(this._grid,'.mlePhotoPlaceholder').length;};y.prototype._getPhotoType=function(ca){"use strict";switch(ca){case 0:case 1:return u;case 2:return v;default:if((ca<0)||(ca>this._photoLimit))throw new Error('invalid number of photos');return w;}};y.prototype._updatePhotoDisplayType=function(ca){"use strict";var da=x[this._photoDisplayType];da&&k.removeClass(this._container,da);this._photoDisplayType=this._getPhotoType(ca);k.addClass(this._container,x[this._photoDisplayType]);};y.prototype._updateAddMorePhotosClass=function(){"use strict";if(this._pendingPhotoRequests>0){k.addClass(l.find(this._container,'.mleAddMorePhotoButtons'),'disabled');}else k.removeClass(l.find(this._container,'.mleAddMorePhotoButtons'),'disabled');};y.prototype._updatePhotos=function(ca,da){"use strict";var ea=da,fa=[],ga=this._photoDisplayType;this._updatePhotoDisplayType(ca);if(this._photoDisplayType!==ga){var ha=l.scry(this._grid,'.mlePhotoPreviewThumb');for(var ia=0;ia<ha.length;ia++){var ja=l.find(ha[ia],'.mlePhotoPreviewInput').value;fa.push(ja);if((this._photoDisplayType===w)||(ga===w)){this._unbindPhoto(ha[ia]);l.remove(ha[ia]);this.createPlaceholder(ja);}else{k.addClass(ha[ia],'photoLoading');k.hide(l.find(ha[ia],'.detachPhotoIcon'));k.show(l.find(ha[ia],'.photoLoadingSpinner'));this._unbindPhoto(ha[ia]);this._tempPhotoRef[ja]=ha[ia];}}}var ka=ea.concat(fa);if(ka.length>0){this._pendingPhotoRequests+=ka.length;if(this._photoDisplayType!==w)this._updateAddMorePhotosClass();var la=g.create('/ajax/timeline/mle_photo_select.php',this._profileID);new i().setURI(la).setData({display_elem:this._containerID,existing_image_ids:fa,field_name:'photos',image_ids:ea,profile_id:this._profileID,total_photos:ca}).setMethod('POST').send();}};y.prototype._bindPhoto=function(ca){"use strict";this._sortableGroup&&this._sortableGroup.addSortable(l.find(ca,'input').getAttribute('value'),ca);};y.prototype._unbindPhoto=function(ca){"use strict";this._sortableGroup&&this._sortableGroup.removeSortable(l.find(ca,'input').getAttribute('value'));};y.prototype.filterPhotoClick=function(event){"use strict";if((this._pendingPhotoRequests>0)&&(this._photoDisplayType!=w))event.kill();};y.prototype.attachPhoto=function(ca,da){"use strict";if((!this._loadingIndicators[da])&&(!this._tempPhotoRef[da]))return;if(this._tempPhotoRef[da]){l.replace(this._tempPhotoRef[da],ca);this._bindPhoto(ca);delete this._tempPhotoRef[da];}else{var ea=this._loadingIndicators[da].getRoot();if(n.byTag(ea,'body')){l.replace(ea,ca);this._bindPhoto(ca);}delete this._loadingIndicators[da];}if(--this._pendingPhotoRequests===0)this._updateAddMorePhotosClass();};y.prototype.detachPhoto=function(ca){"use strict";if(this._pendingPhotoRequests>0)return;this._unbindPhoto(ca);l.remove(ca);var da=this._getNumPhotos();this._updatePhotos(da,[]);if(da===0){k.show(l.find(this._container,'.mlePhotoButtons'));k.hide(l.find(this._container,'.mleAddMorePhotoButtons'));}else if(da===this._photoLimit-1)k.show(l.find(this._container,'.mleAddMorePhotoButtons'));};y.prototype.createPlaceholder=function(ca){"use strict";var da=this._progressBarMarkup.cloneNode(true);da=l.appendContent(this._grid,da)[0];this._loadingIndicators[ca]=new o(da);return da;};y.prototype.addPhotos=function(ca){"use strict";var da=this._getNumPhotos(),ea=ca.length,fa=da+ea;if(fa>this._photoLimit){var ga=r._("The maximum number of photos you can add to this life event is {limit}. Please remove some photos and try again.",[r.param("limit",this._photoLimit)]);j.loadModules(["Dialog"],function(ja){new ja().setTitle("Too Many Photos").setBody(ga).setButtons(ja.OK).show();});return;}if(fa===this._photoLimit)k.hide(l.find(this._container,'.mleAddMorePhotoButtons'));var ha=ca.slice(0,ea);this._updatePhotos(fa,ha);for(var ia=0;ia<ea;ia++)this.createPlaceholder(ca[ia]);};y.prototype.destroyPlaceholder=function(ca){"use strict";if(!this._loadingIndicators[ca])return;l.remove(this._loadingIndicators[ca].getRoot());delete this._loadingIndicators[ca];};y.prototype.initUploader=function(ca,da){"use strict";var ea=ca.getInput();ea.multiple=h.isSupported();ca.subscribe('change',this._uploadPhotos.bind(this,ea,da));};y.prototype._setSaveButtonEnabled=function(ca){"use strict";s.setEnabled(this._saveButton,ca);};y.prototype._uploadPhotos=function(ca,da){"use strict";k.hide(l.find(this._container,'.mlePhotoButtons'));k.show(l.find(this._container,'.mleAddMorePhotoButtons'));var ea=this._getNumPhotos(),fa=ca.files?ca.files.length:1,ga=ea+fa;if(ga>this._photoLimit){var ha=r._("The maximum number of photos you can add to this life event is {limit}. Please remove some photos and try again.",[r.param("limit",this._photoLimit)]);j.loadModules(["Dialog"],function(ma){new ma().setTitle("Too Many Photos").setBody(ha).setButtons(ma.OK).show();});z(ca);return;}var ia,ja;for(var ka=0;ka<fa;ka++){ja=ca.files?ca.files[ka].name:ca.value.split('\\').pop();ia=this.createPlaceholder(ja);}this._updatePhotos(ga,[]);da.uploadData.total_photos=ga;if(this._photoDisplayType!=w)this._pendingPhotoRequests+=fa;var la=new m(ca).setURI(da.uploadURI).setData(da.uploadData).setAllowCrossOrigin(true).setUploadInParallel(true);la.subscribe('progress',this._onProgress.bind(this));la.subscribe('success',this._onSuccess.bind(this));la.subscribe('failure',this._onFailure.bind(this,ja));la.send();this._setSaveButtonEnabled(false);z(ca);};y.prototype._onProgress=function(ca,da){"use strict";var event=da.event,ea=this._loadingIndicators[da.upload.getFile().name];k.hide(l.find(ea.getRoot(),'.mlePhotoLoadingIndicator'));k.show(l.find(ea.getRoot(),'.mlePhotoProgressBar'));if(event.loaded==event.total){ea.setPosition(50);ea.setTarget(100,2000);}else ea.setPosition(50*event.loaded/event.total);};y.prototype._onSuccess=function(ca,da){"use strict";this._setSaveButtonEnabled(true);};y.prototype._onFailure=function(ca){"use strict";this.destroyPlaceholder(ca);this._setSaveButtonEnabled(true);};function z(ca){ca.value='';ca.files=null;}function aa(ca){k.addClass(ca,'dragging');}function ba(ca,da){k.removeClass(da,'dragging');}e.exports=y;},null);
__d("TimelineMLEPhotoPreview",["Event","CSS","Dialog","DOM","Layer","Parent","TimelineLifeEventPhotoPreviewGrid","$"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=[],p={initPreviewGrid:function(q,r,s){var t=l.byClass(q,'mleContainer');p.destroyPreviewGrid(t);o[t.id]=new m(t,q,r,s);g.listen(j.find(t,'.mleAddMorePhotoButtons'),'click',function(event){o[t.id].filterPhotoClick(event);});},destroyPreviewGrid:function(q){if(o[q.id]){o[q.id].destroy();delete o[q.id];}},initUploader:function(q,r,s){if(o[r])o[r].initUploader(q,s);},attachPhoto:function(q,r,s){if(o[q])o[q].attachPhoto(r,s);},listenForDetach:function(q,r){var s=o[r];g.listen(j.find(q,'.detachPhotoIcon'),'click',s.detachPhoto.bind(s,q));},listenForPhotoSelect:function(q,r){var s=n(r.display_elem),t=false;g.listen(q,'click',function(){if(t)return;t=true;h.hide(j.find(s,'.mlePhotoButtons'));h.show(j.find(s,'.mleAddMorePhotoButtons'));var u=i.getCurrent();if(u)u.hide();var v=o[s.id];if(v)v.addPhotos([r.photo_fbid]);});},listenForSubmit:function(q,r,s){var t=n(s);q.subscribe('confirm',function(){var u=j.scry(q.getContentRoot(),'input[name="'+r+'"]'),v=[];for(var w=0;w<u.length;w++){var x=u[w];if(x.checked===true)v.push(x.value);}h.hide(j.find(t,'.mlePhotoButtons'));h.show(j.find(t,'.mleAddMorePhotoButtons'));var y;if(y=i.getCurrent())y.hide();if(y=k.getTopmostLayer())y.hide();if(o[t.id])o[t.id].addPhotos(v);});}};e.exports=p;},null);
__d("TimelineMLE",["Arbiter","AsyncRequest","Bootloader","ComposerXController","CSS","DOM","DOMScroll","Event","Form","Parent","ProgressiveDatepicker","RelationshipStatusConst","TimelineCapsule","TimelineComposerUtilities","TimelineContentLoader","TimelineMLEPhotoPreview","$","areJSONRepresentationsEqual","csx","cx","fbt","ge","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){var da=0,ea={},fa=null,ga=null;function ha(sa){return p.byClass(sa,'mleFlyoutForm');}function ia(sa){var ta=p.byClass(sa.getContext(),'fbTimelineCapsule');if(ta)return ta;return u.capsuleForCurrentSection();}function ja(sa){var ta=o.serialize(sa);la(sa,ta);ka(sa,ta);if(!x(ta,ea.state)){ma(sa);new h().setData(ta).setURI('/ajax/timeline/mle_header.php').setRelativeTo(sa).send();}}function ka(sa,ta){var ua=l.scry(sa,"._594n")[0];if(!ua)return;var va=ta.hasOwnProperty('name')?ta.name:ta.text_with&&ta.text_with[0];if(va)l.setContent(ua,aa._("{name} will be added to the Family section on your profile.",[aa.param("name",va)]));k.conditionClass(ua,'hidden_elem',!va);}function la(sa,ta){var ua=parseInt(ta.type,10),va=ta['with'],wa=l.scry(sa,'input.updateRelationshipStatus')[0];if(!wa)return;var xa=l.scry(sa,'li.relationshipConfirmation')[0];if(!xa)return;var ya=l.find(sa,'li.relationshipTooManyPartners');if(va&&va.length>1){k.hide(xa);k.show(ya);wa.checked=false;wa.disabled=true;return;}k.hide(ya);wa.disabled=false;var za=va&&va[0],ab=l.find(sa,'input.relationshipCurrentPartnerID').value,bb=l.find(sa,'input.relationshipCurrentStatus').value,cb=r.isUnilateralStatus(ua),db=wa.checked&&!cb&&za&&(ab!=za||bb!=ua);if(za){var eb=ta.text_with[0],fb=l.find(sa,'span.relationshipPartnerName');l.setContent(fb,eb);}k.conditionClass(xa,'hidden_elem',!db);}function ma(sa){sa=sa||ea.element;if(!sa)return;ea={element:sa,state:o.serialize(sa)};}function na(event){var sa=event.getTarget(),ta=sa.options[sa.selectedIndex];g.inform('TimelineMLE/mleSelectUpdated',sa);var ua=p.byClass(ta,'mleFormContainer');ja(ua);var va=l.scry(ua,'.mleOtherLabel'),wa=l.scry(ua,'.mleOtherField');if(va.length)va=va[0];if(wa.length)wa=wa[0];if(k.hasClass(ta,'mleOther')){k.show(va);k.show(wa);var xa=l.find(wa,'.inputOuter').firstChild;xa.focus();}else{k.hide(va);k.hide(wa);}}function oa(){if(!fa)return;var sa=fa,ta=l.scry(sa.getInnerContent(),'.mleContainer')[0];ta&&v.destroyPreviewGrid(ta);sa.hide();ea={};fa=null;g.inform('TimelineMLE/mleFlyoutHidden');}function pa(sa,ta){l.replace(w(sa),ta);}function qa(sa){if(sa)n.listen(sa,'change',na);}var ra={cancel:function(sa){if(ha(sa)){ra.hideFlyout();}else{var ta=p.byClass(sa,'mleContainer');ta&&v.destroyPreviewGrid(ta);var ua=p.byClass(sa,'fbTimelineNewMLE'),va=p.byClass(sa,'fbTimelineCapsule');if(ua){l.remove(ua);}else{ua=p.byClass(sa,'fbTimelineEditMLE');k.removeClass(ua,'fbTimelineEditMLE');l.remove(l.scry(ua,'.timelineUnitContainer')[0]);k.show(l.scry(ua,'.timelineUnitContainer')[0]);}if(k.hasClass(ua,'fbTimelineNotStarred')){k.removeClass(ua,'fbTimelineNotStarred');i.loadModules(["TimelineStar"],function(wa){wa.unstarUnit(ua.childNodes[0],null,true);});}va&&s.balanceCapsule(va);g.inform('TimelineMap/resizeCallout');}ea={};return false;},registerButtons:function(sa,ta,ua,va){ca(n.listen(ta,'mousedown',function(){sa.standalone?fa.setStackable(false):l.setContent(l.find(va,'.mleInlineErrorMsg'),'');}));if(ua)ca(n.listen(ua,'click',function(wa){wa.prevent();if(sa.location==='map')g.inform('TimelineMap/cancelCreation');sa.standalone?ra.hideFlyout():ra.cancel(ua);}));},replace:function(sa,ta){var ua=p.byClass(sa,'mleContainer');ua&&v.destroyPreviewGrid(ua);if(ha(sa)){var va=p.byClass(sa,'fbTimelineEditMLEFlyout');if(va){sa=p.byClass(w(ta.relativeElementID),'fbTimelineEditMLE');ra.hideFlyout();l.replace(sa,ta.streamStory);sa=w(ta.streamStory);}else{var wa=function(za){var ab=ba(ta.relativeElementID);ab&&j.reset(ab);za.publish(ta,ta.streamStory);ra.hideFlyout();};if(ta.isFinch){i.loadModules(["PagesStoryPublisher"],wa);}else i.loadModules(["TimelineStoryPublisher"],wa);sa=w(ta.streamStory);}}var xa=l.scry(sa,'div.keepStarred')[0];if(xa)i.loadModules(["TimelineStar"],function(za){za.starUnit(xa,null,true);});var ya=p.byClass(sa,'fbTimelineCapsule');ya&&s.balanceCapsule(ya);return false;},startEdit:function(sa,ta){ra.hideFlyout();var ua=l.scry(sa,'div.timelineUnitContainer')[0];k.hide(ua);k.addClass(sa,'fbTimelineEditMLE');if(!ta)k.addClass(sa,'fbTimelineNotStarred');},showFlyout:function(sa,ta,ua){ra.hideFlyout();fa=sa;da=0;g.subscribe('TimelineMLE/mleSelectUpdated',function(za,ab){var bb=p.byClass(ab,'mleFormOuterContainer'),cb=l.scry(bb,'.registrationLink');if(!cb.length)return;var db=ab.selectedIndex;k.hide(cb[da]);k.show(cb[db]);da=db;});sa.show();if(ta==='edit'){var va=w(ua),wa=p.byClass(va,"_5jmm")||p.byClass(va,'lifeEventContainer');k.addClass(wa,'fbTimelineEditMLE');var xa=l.find(sa.getInnerContent(),'.timelineUnitContainer');k.addClass(xa,'fbTimelineEditMLEFlyout');m.ensureVisible(xa,null,100);}if(ta!='map'){var ya=l.scry(sa.getInnerContent(),'.mleSelect');if(ya.length)qa(ya[0]);}if(ta!=='edit')ra.setEstimatedDate(sa);g.inform('TimelineMLE/mleFlyoutShown',sa);},showPrivacyNotice:function(sa,ta){if(!ta||!sa)return;var ua=l.find(sa.getInnerContent(),'.audienceSelector');ta.setContext(ua).show();ga=ta;n.listen(ua,'click',ta.hide.bind(ta));n.listen(l.find(ta.getContent(),'input'),'click',ta.hide.bind(ta));g.subscribe('TimelineMLE/mleFlyoutHidden',ta.hide.bind(ta));},hideFlyout:oa,getFlyout:function(){return fa;},listenForEditChanges:function(sa){var ta=l.find(sa,'form.mleFormContainer'),ua=ta.elements;for(var va=0;va<ua.length;++va){if(p.byClass(ua[va],'uiTypeahead')||p.byClass(ua[va],'uiTokenizer')||k.hasClass(ua[va],'mleSelect'))continue;if(k.hasClass(ua[va],'inputradio')){n.listen(ua[va],'click',ja.bind(null,ta));}else if(p.byClass(ua[va],'mleDatepicker')){n.listen(ua[va],'change',ja.bind(null,ta));}else n.listen(ua[va],'blur',ja.bind(null,ta));}ea={element:ta,state:o.serialize(ta)};var wa=l.scry(sa,'input.updateRelationshipStatus')[0];if(wa)ca(n.listen(wa,'change',function(){var xa=o.serialize(ta);la(ta,xa);}));},updateHeader:function(sa){ja(p.byClass(sa,'mleFormContainer'));},setEstimatedDate:function(sa){var ta=l.scry(sa.getContentRoot(),'.fbTimelineComposerUnit')[0];if(!ta){var ua=q.getInstance(l.scry(sa.getInnerContent(),'.uiProgressiveDatepicker')[0]);if(ua)t.setEstimatedDate(ua,ia(sa));}},updatePrivacyNoticePosition:function(){ga&&ga.updatePosition();},registerOptionHandler:function(sa){var ta=l.scry(sa,'.lifeEventContainer')[0],ua=l.scry(ta,'.mleSelect');if(ua.length)qa(ua[0]);},subscribeToTypeahead:function(sa,ta){sa.subscribe(['select','unselect','reset','blur'],ra.updateHeader.bind(null,ta));},subscribeToTokenizer:function(sa,ta){sa.subscribe(['addToken','removeToken'],ra.updateHeader.bind(null,ta));},replaceYearlySummary:function(sa){pa('pagelet_yearly',sa);oa();},replaceHometown:function(sa){pa('pagelet_hometown',sa);oa();}};e.exports=a.TimelineMLE||ra;},null);